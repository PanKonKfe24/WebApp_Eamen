<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionar Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .form-container {
            width: 20%;
        }
        .table-container {
            width: 60%;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .card {
            box-shadow: 0 4px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>

<div class="container">
    <!-- Primer div: Buscar y editar producto -->
    <div class="form-container card p-3">
        <h4 class="text-center">Buscar Cita</h4>
        <div class="input-group">
            <input type="number" class="form-control" id="buscarId" placeholder="Ingrese el Numero del cliente">
            <button class="btn btn-primary" id="buscarBtn">Buscar</button>
        </div>
        <form action="/Editar" method="POST" id="editarForm" style="display:none;">
            <input type="hidden" id="Numero" name="Numero">
            <div class="mb-3">
                <label for="Cliente" class="form-label">Cliente</label>
                <input type="text" class="form-control" id="Cliente" name="Cliente" readonly>
            </div>
            <div class="mb-3">
                <label for="Cita" class="form-label">Tipo de Cita</label>
                <input type="Text" class="form-control" id="Cita" name="Cita" readonly>
            </div>
            <div class="mb-3">
                <label for="Fecha" class="form-label">Fecha</label>
                <input type="text" class="form-control" id="Fecha" name="Fecha" readonly>
            </div>
            <div class="mb-3">
                <label for="Estado" class="form-label">Estado</label>
                <select class="form-select" id="Estado" name="Estado" required>
                    <option value="CONFIRMADA">Confirmar</option>
                    <option value="CANCELADA">Cancelar</option>
                </select>
            </div>
            <button type="submit" class="btn btn-success">Guardar Cambios</button>
        </form>
    </div>

    <!-- Segundo div: Tabla de productos -->
    <div class="table-container card p-3">
        <h4 class="text-center">Todos los Productos</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Numero</th>
                    <th>Cliente</th>
                    <th>Cita</th>
                    <th>Fecha y Hora</th>
                    <th>Estado</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="Clientes">
                <!-- Aquí se llenará la tabla con productos desde el servidor -->
                {% for Cliente in Clientes %}
                    <tr>
                        <td>{{ Cliente['Numero'] }}</td>
                        <td>{{ Cliente['Cliente'] }}</td>
                        <td>{{ Cliente['Cita'] }}</td>
                        <td>{{ Cliente['Fecha'] }}</td>
                        <td>{{ Cliente['Estado'] }}</td>
                        <td>
                            {% if Cliente['Estado'] == 'CANCELADA' %}
                            <a href="/Eliminar/{{ Cliente['Numero'] }}" class="btn btn-danger">Eliminar</a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Tercer div: Formulario para agregar producto -->
    <div class="form-container card p-3">
        <h4 class="text-center">Generar Cita</h4>
        <form action="/RegistrarCita" method="POST">
            <div class="mb-3">
                <label for="Numero" class="form-label">Numero</label>
                <input  type="text" class="form-control" id="Numero" name="Numero" required>
            </div>
            <div class="mb-3">
                <label for="Nombre" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="Nombre" name="Nombre" required>
            </div>
            <div class="mb-3">
                <label for="Cita" class="form-label">Cita</label>
                <select class="form-select" id="Cita" name="Cita" required>
                    <option value="Manicurista">Manicurista</option>
                    <option value="Peluqueria">Peluqueria</option>
                    <option value="Dermatologia">Dermatologia</option>
                    <option value="Salud">Salud</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="Fecha" class="form-label">Fecha y Hora</label>
                <input type="datetime-local" class="form-control" id="Fecha" name="Fecha" required>
            </div>
            <button type="submit" class="btn btn-primary">Agregar Cita</button>
        </form>
    </div>
</div>

<script>
    // Convierte el objeto productos a un formato JSON que puede ser usado en JavaScript
    var Matriz = {{ Clientes|tojson }};

    // Lógica para buscar un producto por ID
    document.getElementById("buscarBtn").addEventListener("click", function() {
        let id = document.getElementById("buscarId").value;

        // Buscar el producto en la lista de productos usando el Nuemro
        let encontrado = Matriz.find(p => p['Numero'] == id);  // Usamos p['Numero'] para acceder al campo 'Numero'

        if (encontrado) {
            // Rellenar los campos del formulario con los valores del producto encontrado
            document.getElementById("Numero").value = encontrado['Numero'];
            document.getElementById("Cliente").value = encontrado['Cliente'];
            document.getElementById("Cita").value = encontrado['Cita'];
            document.getElementById("Fecha").value = encontrado['Fecha'];
            document.getElementById("Estado").value = encontrado['Estado'];

            // Mostrar el formulario de edición
            document.getElementById("editarForm").style.display = "block";
        } else {
            alert("Producto no encontrado.");
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>